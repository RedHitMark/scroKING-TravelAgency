<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" type="image/png" href="IMG/favicon.png" />
    <link rel="stylesheet" href="CSS/main.css">
    <link rel="stylesheet" href="Font/fontawesome-free-5.10.1-web/css/all.css">
    <title>ScroKING viaggi</title>
</head>

<body>
<div id="header"></div>

<div id="wrapper">
    <section id="logPage">
        <div id="loading" class="row">
            <article>
                <div class="fa-10x">
                    <i class="fas fa-spinner fa-pulse"></i>
                </div>
            </article>
        </div>

        <div id="logs">
            <table>
                <tr>
                    <th>Risultato</th>
                    <th>Data</th>
                    <th>IP</th>
                </tr>
                <tbody id="loginLogsTableBody"></tbody>
            </table>
        </div>
    </section>
</div>

<div id="footer"></div>
</body>
<script src="JS/jquery.min.js"></script>
<script src="JS/loadheaderfooter.js"></script>
<script src="JS/menu.js"></script>
<script src="JS/http.js"></script>
<script src="JS/time.js"></script>
<script>
    function loadData() {
        function dati_ok(json_response) {
            console.log(json_response);

            let loginLogsTableBody = "";

            $.each(json_response, function(index, log) {
                const ip = log.ip;
                const location = log.location;

                const ipString = ip + " (" + location + ")";

                let newRow;

                if(log.result === "OK") {
                    newRow = "<tr><td>" + "<i class='fas fa-check-circle'></i>" +  "</td><td>" + timestamp2string(log.timestamp) + "</td><td>" + ipString + "</td></tr>";
                } else {
                    newRow = "<tr><td>" + "<i class='fas fa-times-circle'></i>"+ "</td><td>" + timestamp2string(log.timestamp) + "</td><td>" + ipString + "</td></tr>";
                }

                loginLogsTableBody += newRow;
            });

            $("#loginLogsTableBody").html(loginLogsTableBody);

            //show things
            $("#loading").css({ 'display' : 'none'});
            $("#server").css({ 'display' : 'block'});
        }

        function dati_internal_server_error(json_response) {

        }

        const functions = {
            200 : dati_ok,
            500 : dati_internal_server_error
        };

        post("api/logs/login_logs.php", null, functions)
    }

    loadData();
</script>
